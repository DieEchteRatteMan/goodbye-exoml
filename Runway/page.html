<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Runway Video Generator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        black: '#000000',
                        dark: '#121212',
                        darker: '#0A0A0A',
                        darkest: '#050505',
                        primary: '#4F46E5',
                        secondary: '#10B981',
                    }
                }
            }
        }
    </script>
    <style>
        ::-webkit-scrollbar {
            width: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #050505;
        }
        ::-webkit-scrollbar-thumb {
            background: #4F46E5;
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #4338CA;
        }
        
        .video-container {
            position: relative;
            max-width: 100%;
        }
        .video-controls {
            position: absolute;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(0, 0, 0, 0.7);
            padding: 10px;
            display: flex;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s;
        }
        .video-container:hover .video-controls {
            opacity: 1;
        }
        .progress-container {
            flex-grow: 1;
            height: 5px;
            background: #333;
            margin: 0 10px;
            position: relative;
            cursor: pointer;
        }
        .progress-bar {
            height: 100%;
            background: #4F46E5;
            width: 0%;
        }
        .control-btn {
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            font-size: 16px;
            margin: 0 5px;
        }
        .control-btn:hover {
            color: #4F46E5;
        }
        
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            z-index: 1000;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #121212;
            border-radius: 12px;
            max-width: 500px;
            width: 90%;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            border: 1px solid #4F46E5;
            text-align: center;
        }
        .modal-logo {
            width: 120px;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .loading-spinner {
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            border-top: 4px solid #4F46E5;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="bg-black text-gray-200 min-h-screen">
    <div id="welcomeModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-center">
                <div class="bg-gradient-to-r from-primary to-secondary p-1 rounded-full">
                    <div class="bg-darkest rounded-full p-4">
                        <svg class="w-16 h-16 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 3v2m6-2v2M9 19v2m6-2v2M5 9H3m2 6H3m18-6h-2m2 6h-2M7 19h10a2 2 0 002-2V7a2 2 0 00-2-2H7a2 2 0 00-2 2v10a2 2 0 002 2zM9 9h6v6H9V9z"></path>
                        </svg>
                    </div>
                </div>
            </div>
            <h2 class="text-2xl font-bold text-white mb-4">Welcome to Runway Video Generator</h2>
            <p class="text-gray-300 mb-6">This experience is powered by exomlapi. Get hundreds of millions of LLM tokens for FREE!</p>
            <div class="mb-6">
                <a href="https://exomlapi.com" target="_blank" class="text-primary hover:underline">Visit exomlapi.com</a>
            </div>
            <button id="continueBtn" class="w-full bg-gradient-to-r from-primary to-secondary text-white font-medium py-2 px-4 rounded-lg hover:opacity-90 transition">
                Continue to App
            </button>
        </div>
    </div>

    <div id="errorModal" class="modal">
        <div class="modal-content">
            <div class="flex justify-center mb-4">
                <svg class="w-16 h-16 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            </div>
            <h2 class="text-2xl font-bold text-white mb-4" id="errorTitle">Error</h2>
            <p class="text-gray-300 mb-6" id="errorMessage">An error occurred while processing your request.</p>
            <button id="closeErrorBtn" class="w-full bg-gradient-to-r from-primary to-secondary text-white font-medium py-2 px-4 rounded-lg hover:opacity-90 transition">
                Close
            </button>
        </div>
    </div>

    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <header class="mb-8">
            <div class="flex justify-between items-center">
                <div>
                    <h1 class="text-3xl font-bold bg-gradient-to-r from-primary to-secondary bg-clip-text text-transparent">Runway Video Generator</h1>
                    <p class="text-gray-400">Powered by ExoML</p>
                </div>
                <div class="text-xs text-gray-500">
                    Free AI Video Generation
                </div>
            </div>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <div class="lg:col-span-1 bg-darker p-6 rounded-xl shadow-lg">
                <h2 class="text-xl font-semibold mb-4 text-primary">Generation Settings</h2>
                
                <div class="space-y-4">
                    <div>
                        <label for="prompt" class="block text-sm font-medium text-gray-300 mb-1">Prompt</label>
                        <textarea id="prompt" rows="3" class="w-full bg-darkest border border-gray-800 rounded-lg px-4 py-2 text-gray-200 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent" placeholder="Describe the video you want to generate..."></textarea>
                    </div>
                    
                    <div>
                        <label for="image" class="block text-sm font-medium text-gray-300 mb-1">Reference Image (Optional)</label>
                        <div class="flex items-center justify-center w-full">
                            <label for="image" class="flex flex-col items-center justify-center w-full h-32 border-2 border-dashed border-gray-700 rounded-lg cursor-pointer bg-darkest hover:bg-darker transition relative overflow-hidden" id="imageDropArea">
                                <div id="imagePreviewContainer" class="absolute inset-0 hidden">
                                    <img id="imagePreview" class="w-full h-full object-cover" src="" alt="Preview">
                                    <div class="absolute inset-0 bg-black bg-opacity-50 flex items-center justify-center opacity-0 hover:opacity-100 transition">
                                        <span class="text-white text-sm">Change Image</span>
                                    </div>
                                </div>
                                <div id="imageUploadPrompt" class="flex flex-col items-center justify-center pt-5 pb-6">
                                    <svg class="w-8 h-8 mb-3 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 16a4 4 0 01-.88-7.903A5 5 0 1115.9 6L16 6a5 5 0 011 9.9M15 13l-3-3m0 0l-3 3m3-3v12"></path>
                                    </svg>
                                    <p class="mb-2 text-sm text-gray-400"><span class="font-semibold">Click to upload</span> or drag and drop</p>
                                    <p class="text-xs text-gray-500">PNG, JPG (MAX. 5MB)</p>
                                </div>
                                <input id="image" type="file" class="hidden" accept="image/*" />
                            </label>
                        </div>
                    </div>
                    
                    <div>
                        <label for="aspectRatio" class="block text-sm font-medium text-gray-300 mb-1">Aspect Ratio</label>
                        <select id="aspectRatio" class="w-full bg-darkest border border-gray-800 rounded-lg px-4 py-2 text-gray-200 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent">
                            <option value="16:9">16:9 (Widescreen)</option>
                            <option value="9:16">9:16 (Portrait)</option>
                            <option value="4:3">4:3 (Standard)</option>
                            <option value="3:4">3:4 (Portrait Standard)</option>
                            <option value="1:1">1:1 (Square)</option>
                        </select>
                    </div>
                    
                    <button id="generate" class="w-full bg-gradient-to-r from-primary to-secondary text-white font-medium py-2 px-4 rounded-lg hover:opacity-90 transition flex items-center justify-center">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                        </svg>
                        Generate Video
                    </button>
                </div>
                
                <div class="mt-8 text-center text-xs text-gray-500">
                    <p>This service is provided for free by <span class="text-secondary">ExoML</span></p>
                    <p class="mt-1 text-gray-600">Note: Only one generation per hour is allowed</p>
                </div>
            </div>
            
            <div class="lg:col-span-2 space-y-8">
                <div class="bg-darker p-6 rounded-xl shadow-lg">
                    <h2 class="text-xl font-semibold mb-4 text-primary">Generated Video</h2>
                    
                    <div id="output" class="flex items-center justify-center min-h-64 bg-darkest rounded-lg overflow-hidden">
                        <div class="text-center p-8 text-gray-500">
                            <svg class="w-12 h-12 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                            </svg>
                            <p>Your generated video will appear here</p>
                        </div>
                    </div>
                </div>
                
                <div class="bg-darker p-6 rounded-xl shadow-lg">
                    <div class="flex justify-between items-center mb-4">
                        <h2 class="text-xl font-semibold text-primary">Generation History</h2>
                        <button id="clearHistory" class="text-xs text-gray-400 hover:text-gray-200">Clear All</button>
                    </div>
                    
                    <div id="history" class="space-y-4 max-h-96 overflow-y-auto pr-2">
                        <div id="historyList" class="grid grid-cols-1 sm:grid-cols-2 gap-4">
                        </div>
                    </div>
                    
                    <div id="emptyHistory" class="text-center py-8 text-gray-500">
                        <svg class="w-12 h-12 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                        <p>No generation history yet</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_ENDPOINT = '/v1/images/generations';
        
        document.addEventListener('DOMContentLoaded', function() {
            const modal = document.getElementById('welcomeModal');
            modal.style.display = 'flex';
            
            document.getElementById('continueBtn').addEventListener('click', function() {
                modal.style.display = 'none';
            });
            
            document.getElementById('closeErrorBtn').addEventListener('click', function() {
                document.getElementById('errorModal').style.display = 'none';
            });
        });

        function showError(title, message) {
            document.getElementById('errorTitle').textContent = title;
            document.getElementById('errorMessage').textContent = message;
            document.getElementById('errorModal').style.display = 'flex';
        }

        let generationHistory = JSON.parse(localStorage.getItem('videoGenerationHistory')) || [];
        const historyList = document.getElementById('historyList');
        const emptyHistory = document.getElementById('emptyHistory');
        
        let lastGenerationTime = localStorage.getItem('lastVideoGenerationTime') || 0;
        
        updateHistoryDisplay();
        
        document.getElementById('clearHistory').addEventListener('click', function() {
            if (confirm('Are you sure you want to clear all generation history?')) {
                generationHistory = [];
                localStorage.setItem('videoGenerationHistory', JSON.stringify(generationHistory));
                updateHistoryDisplay();
            }
        });
        
        const imageInput = document.getElementById('image');
        const imagePreview = document.getElementById('imagePreview');
        const imagePreviewContainer = document.getElementById('imagePreviewContainer');
        const imageUploadPrompt = document.getElementById('imageUploadPrompt');
        const imageDropArea = document.getElementById('imageDropArea');
        
        imageInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    imagePreview.src = event.target.result;
                    imagePreviewContainer.style.display = 'block';
                    imageUploadPrompt.style.display = 'none';
                }
                reader.readAsDataURL(file);
            }
        });
        
        imageDropArea.addEventListener('dragover', function(e) {
            e.preventDefault();
            imageDropArea.classList.add('border-primary');
        });
        
        imageDropArea.addEventListener('dragleave', function() {
            imageDropArea.classList.remove('border-primary');
        });
        
        imageDropArea.addEventListener('drop', function(e) {
            e.preventDefault();
            imageDropArea.classList.remove('border-primary');
            
            const file = e.dataTransfer.files[0];
            if (file && file.type.match('image.*')) {
                imageInput.files = e.dataTransfer.files;
                const reader = new FileReader();
                reader.onload = function(event) {
                    imagePreview.src = event.target.result;
                    imagePreviewContainer.style.display = 'block';
                    imageUploadPrompt.style.display = 'none';
                }
                reader.readAsDataURL(file);
            }
        });
        
        document.getElementById('generate').addEventListener('click', async function() {
            const prompt = document.getElementById('prompt').value.trim();
            const imageFile = document.getElementById('image').files[0];
            const aspectRatio = document.getElementById('aspectRatio').value;
            
            if (!prompt) {
                showError('Input Required', 'Please enter a prompt');
                return;
            }
            
            const now = Date.now();
            const lastGenTime = parseInt(lastGenerationTime);
            const oneHour = 60 * 60 * 1000;
            
            if (now - lastGenTime < oneHour) {
                const timeLeft = Math.ceil((oneHour - (now - lastGenTime)) / (60 * 1000));
                showError('Rate Limit Exceeded', `You can only generate one video per hour. Please wait ${timeLeft} more minutes before generating another video.`);
                return;
            }
            
            const formData = new FormData();
            formData.append('prompt', prompt);
            formData.append('aspectRatio', aspectRatio);
            if (imageFile) {
                formData.append('image', imageFile);
            }
            
            const generateBtn = document.getElementById('generate');
            generateBtn.disabled = true;
            generateBtn.innerHTML = `
                <div class="loading-spinner mr-2"></div>
                Generating...
            `;
            
            const outputDiv = document.getElementById('output');
            outputDiv.innerHTML = `
                <div class="w-full h-full flex flex-col items-center justify-center p-8">
                    <div class="loading-spinner mb-4"></div>
                    <p class="text-gray-300">Generating your video...</p>
                    <p class="text-xs text-gray-500 mt-2">This may take a few moments</p>
                </div>
            `;
            
            try {
                const response = await fetch(API_ENDPOINT, {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.error || 'Failed to generate video');
                }
                
                const responseData = await response.json();
                
                if (responseData.error) {
                    if (responseData.error === 'rate_limit_exceeded') {
                        showError('Rate Limit Exceeded', responseData.message || 'Too many requests. Please wait an hour.');
                    } else {
                        throw new Error(responseData.error);
                    }
                    return;
                }
                
                if (!responseData.data || !responseData.data[0] || !responseData.data[0].url) {
                    throw new Error('Invalid response from server');
                }
                
                const videoUrl = responseData.data[0].url;
                const thumbnailUrl = responseData.data[0].thumbnail;
                
                const newItem = {
                    id: Date.now(),
                    prompt: prompt,
                    timestamp: new Date().toISOString(),
                    videoUrl: videoUrl,
                    thumbnailUrl: thumbnailUrl
                };
                
                generationHistory.unshift(newItem);
                if (generationHistory.length > 20) {
                    generationHistory = generationHistory.slice(0, 20);
                }
                
                localStorage.setItem('videoGenerationHistory', JSON.stringify(generationHistory));
                localStorage.setItem('lastVideoGenerationTime', now.toString());
                lastGenerationTime = now;
                
                updateHistoryDisplay();
                
                displayVideo(videoUrl, thumbnailUrl);
                
            } catch (error) {
                console.error('Error:', error);
                showError('Generation Failed', error.message || 'An error occurred while generating the video.');
                
                outputDiv.innerHTML = `
                    <div class="text-center p-8 text-gray-500">
                        <svg class="w-12 h-12 mx-auto mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1" d="M15 10l4.553-2.276A1 1 0 0121 8.618v6.764a1 1 0 01-1.447.894L15 14M5 18h8a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v8a2 2 0 002 2z"></path>
                        </svg>
                        <p>Your generated video will appear here</p>
                    </div>
                `;
            } finally {
                generateBtn.disabled = false;
                generateBtn.innerHTML = `
                    <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 10V3L4 14h7v7l9-11h-7z"></path>
                    </svg>
                    Generate Video
                `;
            }
        });
        
        function updateHistoryDisplay() {
            if (generationHistory.length === 0) {
                historyList.innerHTML = '';
                emptyHistory.style.display = 'block';
                return;
            }
            
            emptyHistory.style.display = 'none';
            historyList.innerHTML = generationHistory.map(item => `
                <div class="bg-darkest rounded-lg overflow-hidden border border-gray-800 hover:border-primary transition group">
                    <div class="relative">
                        <img src="${item.thumbnailUrl}" alt="Thumbnail" class="w-full h-32 object-cover">
                        <div class="absolute inset-0 bg-black bg-opacity-50 opacity-0 group-hover:opacity-100 transition flex items-center justify-center">
                            <button onclick="displayVideo('${item.videoUrl}', '${item.thumbnailUrl}')" class="bg-primary rounded-full p-2 text-white hover:bg-opacity-90 transition">
                                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="p-3">
                        <p class="text-sm text-gray-300 truncate" title="${item.prompt}">${item.prompt}</p>
                        <div class="flex justify-between items-center mt-2">
                            <span class="text-xs text-gray-500">${new Date(item.timestamp).toLocaleString()}</span>
                            <button onclick="downloadVideo('${item.videoUrl}')" class="text-xs text-gray-400 hover:text-primary transition">
                                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                                </svg>
                            </button>
                        </div>
                    </div>
                </div>
            `).join('');
        }
        
        function displayVideo(videoUrl, thumbnailUrl) {
            const outputDiv = document.getElementById('output');
            outputDiv.innerHTML = `
                <div class="video-container w-full">
                    <video id="generatedVideo" class="w-full" poster="${thumbnailUrl}" loop>
                        <source src="${videoUrl}" type="video/mp4">
                        Your browser does not support the video tag.
                    </video>
                    <div class="video-controls">
                        <button class="control-btn play-pause">
                            <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
                            </svg>
                        </button>
                        <div class="progress-container">
                            <div class="progress-bar"></div>
                        </div>
                        <button class="control-btn download-btn" onclick="downloadVideo('${videoUrl}')">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 16v1a3 3 0 003 3h10a3 3 0 003-3v-1m-4-4l-4 4m0 0l-4-4m4 4V4"></path>
                            </svg>
                        </button>
                    </div>
                </div>
            `;
            
            const video = document.getElementById('generatedVideo');
            const playPauseBtn = document.querySelector('.play-pause');
            const progressBar = document.querySelector('.progress-bar');
            
            playPauseBtn.addEventListener('click', function() {
                if (video.paused) {
                    video.play();
                    playPauseBtn.innerHTML = `
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                        </svg>
                    `;
                } else {
                    video.pause();
                    playPauseBtn.innerHTML = `
                        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
                        </svg>
                    `;
                }
            });
            
            video.addEventListener('timeupdate', function() {
                const progress = (video.currentTime / video.duration) * 100;
                progressBar.style.width = progress + '%';
            });
            
            document.querySelector('.progress-container').addEventListener('click', function(e) {
                const rect = this.getBoundingClientRect();
                const pos = (e.pageX - rect.left) / rect.width;
                video.currentTime = pos * video.duration;
            });
            
            video.play();
            playPauseBtn.innerHTML = `
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 9v6m4-6v6m7-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>
            `;
        }
        
        function downloadVideo(url) {
            const a = document.createElement('a');
            a.href = url;
            a.download = `runway-video-${Date.now()}.mp4`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }
    </script>
</body>
</html>